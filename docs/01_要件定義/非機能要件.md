# 受講生管理システム - 非機能要件

## 1. 性能要件

### 1.1 想定規模

| 項目 | 値 |
|------|-----|
| 同時利用者数 | 10人程度 |
| 受講生データ件数 | 1,000〜10,000人 |

### 1.2 レスポンス要件

| 処理 | 目標レスポンス時間 |
|------|-------------------|
| 画面表示（一覧） | 2秒以内 |
| 画面表示（詳細） | 1秒以内 |
| データ登録・更新 | 1秒以内 |
| 検索処理 | 3秒以内 |

---

## 2. 可用性

| 項目 | 要件 |
|------|------|
| 稼働時間 | 24時間365日 |
| 目標稼働率 | 99%以上（年間ダウンタイム約3.6日以内） |
| 計画停止 | 事前通知のうえ、深夜帯に実施 |

---

## 3. バックアップ・リカバリ

| 項目 | 要件 |
|------|------|
| バックアップ頻度 | 1日1回（日次バックアップ） |
| バックアップ対象 | データベース全体 |
| 保持期間 | 7日間（直近7世代を保持） |
| リカバリ目標時間（RTO） | 4時間以内 |
| リカバリ目標地点（RPO） | 24時間以内（最大1日分のデータ損失を許容） |

---

## 4. セキュリティ

### 4.1 認証・認可

| 項目 | 要件 |
|------|------|
| 認証方式 | 自前認証（ユーザー名 + パスワード）+ JWT |
| トークン構成 | アクセストークン（短期）+ リフレッシュトークン（長期） |
| アクセストークン有効期限 | 15分〜1時間 |
| リフレッシュトークン有効期限 | 7日〜30日 |
| 多要素認証（MFA） | 不要（Phase 1） |
| 認可 | ロールベースアクセス制御（RBAC） |

### 4.2 パスワードポリシー

NIST SP 800-63B（デジタルアイデンティティガイドライン）に準拠

| 項目 | 要件 |
|------|------|
| 最小文字数 | 8文字以上 |
| 最大文字数 | 64文字以上を許容 |
| 文字種制限 | 特になし（複雑さの強制は推奨されない） |
| 禁止パスワード | よく使われるパスワード（辞書チェック） |
| パスワード保存 | bcrypt または Argon2 でハッシュ化 |
| パスワード有効期限 | 設定しない（定期変更は推奨されない） |

### 4.3 通信・データ保護

| 項目 | 要件 |
|------|------|
| 通信暗号化 | HTTPS（TLS 1.2以上）必須 |
| 機密データの暗号化 | パスワードはハッシュ化、その他必要に応じて暗号化 |
| CSRF対策 | トークンベースの対策を実装 |
| XSS対策 | 適切なエスケープ処理、CSP設定 |
| SQLインジェクション対策 | プリペアドステートメント使用 |

---

## 5. ユーザビリティ

### 5.1 対応ブラウザ

| ブラウザ | 対応バージョン |
|----------|---------------|
| Google Chrome | 最新版および1つ前のメジャーバージョン |
| Mozilla Firefox | 最新版および1つ前のメジャーバージョン |
| Safari | 最新版および1つ前のメジャーバージョン |
| Microsoft Edge | 最新版および1つ前のメジャーバージョン |

※ Internet Explorer は対応しない

### 5.2 レスポンシブ対応

| Phase | 対応状況 |
|-------|----------|
| Phase 1（管理者・スタッフ・講師向け） | デスクトップのみ対応 |
| Phase 2（受講生向け） | レスポンシブ対応予定 |

---

## 6. インフラ・ホスティング

### 6.1 ホスティング環境

| 項目 | 選定 |
|------|------|
| プラットフォーム | **Railway** |
| 構成 | フロントエンド・バックエンド・データベースを一括管理 |

### 6.2 Railway 選定理由

- フロント（Next.js）・バック（Java）・DB（PostgreSQL）を一元管理できる
- GitHub 連携による自動デプロイが可能
- 設定がシンプルで運用負荷が低い
- 日本からのアクセスも問題ないレイテンシ

### 6.3 環境構成

| 環境 | 用途 | 備考 |
|------|------|------|
| 開発環境（Local） | 開発・デバッグ | 各開発者のローカルマシン |
| ステージング環境 | テスト・検証 | 本番と同等の構成（Railway） |
| 本番環境 | 実運用 | Railway |

---

## 7. CI/CD

| 項目 | 選定・方針 |
|------|-----------|
| CI/CDツール | **GitHub Actions** |
| トリガー | main ブランチへのプッシュ・マージ |
| 自動テスト | 単体テスト、統合テストを実行 |
| 自動デプロイ | テスト成功後、Railway へ自動デプロイ |

### 7.1 パイプライン概要

```
Push/PR → Lint → Test → Build → Deploy（staging/production）
```

---

## 8. 外部システム連携

### 8.1 連携先システム

| 連携先 | 連携方式 | 連携内容 |
|--------|----------|----------|
| 決済システム | Webhook（受信） | カード決済完了通知 |
| チャットシステム（Discord/Slack） | REST API（受信） | ユーザー名同期、受講開始通知 |

### 8.2 API セキュリティ

| 項目 | 要件 |
|------|------|
| 認証方式 | APIキー または JWT |
| 通信 | HTTPS必須 |
| レート制限 | 必要に応じて設定 |
| IP制限 | 必要に応じて許可リストを設定 |

### 8.3 Webhook 受信

| 項目 | 要件 |
|------|------|
| 署名検証 | Webhookの署名を検証する |
| リトライ対応 | 冪等性を確保し、重複リクエストに対応 |
| タイムアウト | 適切なタイムアウト設定 |

---

## 9. ログ管理

### 9.1 ログの種類

| 種類 | 内容 | 保持期間 |
|------|------|----------|
| アクセスログ | リクエスト元、URL、レスポンスコード、処理時間 | 90日 |
| エラーログ | 例外・エラー情報、スタックトレース | 90日 |
| 認証ログ | ログイン・ログアウト、認証失敗 | 90日 |
| 操作ログ（監査ログ） | データの作成・更新・削除（誰が・いつ・何を） | 3年 |

### 9.2 ログ方針

| 項目 | 方針 |
|------|------|
| ログ出力先 | 標準出力（Railway のログ機能で収集） |
| ログレベル | ERROR, WARN, INFO, DEBUG を使い分け |
| 本番環境のログレベル | INFO 以上を出力 |
| 個人情報の取り扱い | ログにメールアドレス・パスワード等を出力しない |
| ログフォーマット | JSON形式（検索・分析しやすいため） |

### 9.3 監査ログの記録項目

受講生データ等の重要データに対する操作を記録

| 項目 | 説明 |
|------|------|
| タイムスタンプ | 操作日時 |
| ユーザーID | 操作を行ったユーザー |
| 操作種別 | CREATE / UPDATE / DELETE |
| 対象リソース | 受講生、コース等 |
| 対象ID | 操作対象のレコードID |
| 変更内容 | 変更前後の値（センシティブ情報は除く） |

---

## 10. 監視・アラート

| 項目 | 方針 |
|------|------|
| 死活監視 | Railway の標準機能を使用 |
| エラー監視 | エラーログの監視、閾値超過時にアラート |
| アラート通知先 | Slack または メール（要設定） |

